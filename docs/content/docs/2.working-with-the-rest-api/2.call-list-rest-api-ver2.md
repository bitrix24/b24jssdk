---
title: CallListV2.make
description: 'Метод для быстрого получения всех данных из списочных методов Bitrix24 REST API версии 2.'
category: 'actions'
restApiVersion: 'rest-api-ver2'
navigation:
  title: CallList
links:
  - label: CallListV2
    iconName: GitHubIcon
    to: https://github.com/bitrix24/b24jssdk/blob/main/packages/jssdk/src/core/actions/v2/call-list.ts
  - label: Result
    iconName: GitHubIcon
    to: https://github.com/bitrix24/b24jssdk/blob/main/packages/jssdk/src/core/result.ts
  - label: SdkError
    iconName: GitHubIcon
    to: https://github.com/bitrix24/b24jssdk/blob/main/packages/jssdk/src/core/sdk-error.ts
---

::warning
We are still updating this page. Some data may be missing here — we will complete it shortly.
::

::caution{title="⚠️ УСТАРЕВАНИЕ REST API"}
**Bitrix24 постепенно переходит на REST API версии 3**.

- При вызове методов, [доступных в REST API v3](https://apidocs.bitrix24.com/api-reference/rest-v3/index.html), метод автоматически выводит предупреждение в лог.
::

## Краткий обзор

Когда необходимо получить все записи из списковых методов REST API версии 2 с максимальной эффективностью и готовостью разместить полный набор данных в памяти, используйте `CallListV2.make()`{lang="ts-type"}.

Этот метод автоматически обрабатывает пагинацию и возвращает все данные в одном массиве.

::note
For importing, exporting, processing all elements and generating reports, we recommend using [`FetchList`](/docs/working-with-the-rest-api/fetch-list-rest-api-ver2/) - it returns an asynchronous generator for step-by-step processing of large lists. 
::

```ts
// Базовое использование
import { EnumCrmEntityTypeId } from '@bitrix24/b24jssdk'

const response = await $b24.actions.v2.callList.make({
  method: 'crm.item.list',
  params: {
    entityTypeId:  EnumCrmEntityTypeId.deal,
    filter: { '>opportunity': 10000 }
  },
  idKey: 'id',
  customKeyForResult: 'items',
  requestId: 'unique-request-id'
})
```

## Сигнатура метода

```ts-type
make<T = unknown>(
  options: ActionCallListV2
): Promise<Result<T[]>>
```

### Параметры

Объект `options` содержит следующие свойства:

| Параметр                 | Тип                                             | Обязательный | Описание                                                                                                                                                                                                    |
|--------------------------|-------------------------------------------------|--------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **`method`**             | `string`{lang="ts-type"}                        | Да           | Название метода REST API, возвращающего список данных (например, `crm.contact.list`, `tasks.task.list`).                                                                                                    |
| **`params`**             | `Omit<TypeCallParams, 'start'>`{lang="ts-type"} | Нет          | Параметры запроса, исключая параметр `start`, так как метод предназначен для получения всех данных в одном вызове. Используйте `filter`, `order`, `select` для управления выборкой.                         |
| **`idKey`**              | `string`{lang="ts-type"}                        | Нет          | Имя поля, содержащего уникальный идентификатор элемента. По умолчанию: `'ID'` (в верхнем регистре). Также может быть `'id'` (в нижнем регистре) или другое поле в зависимости от структуры данных REST API. |
| **`customKeyForResult`** | `string`{lang="ts-type"}                        | Нет          | Пользовательский ключ, указывающий на то, что ответ REST API будет отобраны по этому полю. Например: `items` для списка CRM-элементов.                                                                      |
| **`requestId`**          | `string`{lang="ts-type"}                        | Нет          | Уникальный идентификатор запроса для отслеживания. Используется для дедупликации запросов и отладки.                                                                                                        |

### Возвращаемое значение

`Promise<Result<T[]>>`{lang="ts-type"} — промис, который разрешается в объект [`Result<T[]>`{lang="ts-type"}](https://github.com/bitrix24/b24jssdk/blob/main/packages/jssdk/src/core/result.ts), содержащий массив всех полученных элементов.

Этот объект предоставляет:

- `.getData(): T[]`{lang="ts-type"} — возвращает массив всех полученных элементов.
- `.isSuccess: boolean`{lang="ts-type"} — флаг, указывающий на успешное выполнение всех запросов.
- `.getErrorMessages(): string[]`{lang="ts-type"} — массив сообщений об ошибках.

## Ключевые концепции

### Автоматическое предупреждение

При вызове методов, которые **доступны в REST API версии 3**, система автоматически выводит предупреждение в лог:

```json
"The method {method_name} is available in restApi:v3. It's worth migrating to the new API."
```

Это указывает на то, что следует рассмотреть возможность миграции на более новую версию REST API.

### Оптимизация производительности

Метод использует несколько оптимизаций для работы с большими объемами данных:

1. **`start: -1`**: Отключает подсчет общего количества записей, что значительно ускоряет выполнение запросов.
2. **Фильтрация по возрастающему ID**: Каждый следующий запрос использует фильтр `>ID` с ID последнего полученного элемента.
3. **Автоматическое определение окончания данных**: Запросы прекращаются, когда получено пустой массив или количество элементов меньше размера страницы (`50`).

### Структура ответов REST API v2

В REST API версии 2 различные методы могут возвращать данные в разных структурах:

- **Прямой массив**: `{ result: [...] }`{lang="ts-type"}
- **Сгруппированный массив**: `{ result: { items: [...] } }`{lang="ts-type"}

Параметр `customKeyForResult` позволяет указать ключ, по которому находятся данные в ответе.

### Ограничения

- **Размер страницы**: Фиксированное ограничение Bitrix24 — 50 записей за запрос.
- **Сортировка**: Метод всегда добавляет сортировку по `idKey` в порядке возрастания для корректной работы пагинации.
- **Только для списковых методов**: Предназначен только для методов, возвращающих массивы данных.

## Обработка ошибок

Всегда проверяйте результат с помощью `isSuccess` и обрабатывайте ошибки:

```ts
const response = await $b24.actions.v2.callList.make({
  method: 'some.method',
  params: { /* some_params */ },
  idKey: 'id',
  customKeyForResult: 'items',
  requestId: 'unique-request-id'
})

if (!response.isSuccess) {
  // Handling error
  console.error(new Error(`Error: ${response.getErrorMessages().join('; ')}`))
  return
}

// Working with a successful result
const data = response.getData()
```

## Examples

### Getting all companies with filtering

```ts [AllCrmItems.ts]
import { B24Hook, EnumCrmEntityTypeId, LoggerFactory, Text, SdkError, AjaxError } from '@bitrix24/b24jssdk'

type Company = {
  id: number
  title: string
}

const devMode = typeof import.meta !== 'undefined' && (globalThis._importMeta_.env?.DEV || false)
const $logger = LoggerFactory.createForBrowser('Example:AllCrmItems', devMode)
const $b24 = B24Hook.fromWebhookUrl('https://your_domain.bitrix24.com/rest/1/webhook_code/')

async function getCrmItemList(requestId: string): Promise<Company[]> {
  const sixMonthAgo = new Date()
  sixMonthAgo.setMonth((new Date()).getMonth() - 6)
  sixMonthAgo.setHours(0, 0, 0)

  const response = await $b24.actions.v2.callList.make<Company>({
    method: 'crm.item.list',
    params: {
      entityTypeId: EnumCrmEntityTypeId.company,
      filter: {
        // use some filter by title
        '=%title': 'Prime%',
        '>=createdTime': Text.toB24Format(sixMonthAgo) // created at least 6 months ago
      },
      select: ['id', 'title']
    },
    idKey: 'id',
    customKeyForResult: 'items',
    requestId
  })

  if (!response.isSuccess) {
    throw new SdkError({
      code: 'MY_APP_GET_PROBLEM'
      description: `Problem ${response.getErrorMessages().join('; ')}`,
      status: 404
    })
  }

  return response.getData()
}

// Использование
const requestId = 'some-crm-item-list'
try {
  const list = await getCrmItemList(requestId)
  $logger.info(`List [${list?.length}]`, { requestId, list })
} catch (error) {
  if (error instanceof AjaxError) {
    $logger.critical(error.message, { requestId, code: error.code })
  } else {
    $logger.alert('Problem', { requestId, error })
  }
}
```

## Альтернативы и рекомендации

* **For working with lists:** Instead of manually managing pagination use:
  * [`FetchList`](/docs/working-with-the-rest-api/fetch-list-rest-api-ver2/) — returns an async generator for step-by-step processing of large lists.
* **For batch operations:** Use [`Batch`](/docs/working-with-the-rest-api/batch-rest-api-ver2/) to execute up to 50 commands in a single request.
* **On the client-side (browser):** Use the built-in [`B24Frame`](/docs/getting-started/installation/vue/#init) object.
